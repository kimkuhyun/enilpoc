# AI 여행 시뮬레이터 - 실시간 3D 지도

실시간 3D 지도에서 경로를 시각화하며 AI 기반 여행 계획을 시뮬레이션하는 MVP 프로젝트입니다.

## 주요 기능

### 1. 실시간 3D 지도 시각화
- **Plotly 3D 지도**: 실제 이동 경로를 지도에 표시
- **경로 애니메이션**: 자동 진행 시 빨간 선으로 이동 경로 그리기
- **현재 위치 추적**: 빨간 마커로 실시간 위치 표시
- **계획 지점 표시**: 파란 마커로 모든 활동 위치 표시

### 2. 분할 화면 레이아웃
```
┌─────────────────────┬──────────────┐
│  왼쪽 (2/3)         │  오른쪽 (1/3) │
│                     │               │
│  3D 지도            │  핸드폰 화면  │
│  ├─ 현재 위치       │  ├─ 상태바   │
│  ├─ 이동 경로       │  ├─ 알림 목록│
│  └─ 활동 지점       │  └─ 챗봇     │
│                     │               │
│  시뮬레이션 제어    │               │
│  ├─ 자동 진행       │               │
│  ├─ 빠른 이동       │               │
│  └─ 수동 제어       │               │
└─────────────────────┴──────────────┘
```

### 3. 자동 진행 모드 (경로 애니메이션)
**"자동 진행 시작" 버튼 클릭 시:**
1. 계획의 첫 번째 활동 지점으로 이동 시작
2. 10단계로 나누어 부드럽게 이동
3. 지도에 빨간 선으로 이동 경로 표시
4. 각 단계마다 0.3초 대기 (애니메이션 효과)
5. 도착 시 자동으로 트리거 확인 및 알림 생성
6. 자동으로 다음 활동으로 진행

**"다음 활동으로" 버튼**: 한 활동씩 수동으로 진행

### 4. 스마트 알림 시스템
- 위치 기반 트리거: 목적지 반경 진입 시 자동 알림
- 시간 기반 트리거: 계획된 시간 도달 시 알림
- 핸드폰 화면에 실시간 표시
- 읽음/새 알림 구분

### 5. 빠른 이동 & 수동 제어
- **빠른 이동**: 계획의 각 활동 버튼 클릭으로 즉시 이동
- **시간 제어**: +15분, +1시간, +3시간 버튼
- **위치 제어**: 프리셋에서 선택하여 이동
- **날씨 제어**: 드롭다운으로 변경

## 설치 및 실행

### 1. 저장소 클론
```bash
git clone <repository-url>
cd enilpoc
```

### 2. 패키지 설치
```bash
pip install -r requirements.txt
```

### 3. 환경 변수 설정
`.env` 파일 생성:
```env
OPENAI_API_KEY=your_key
# 또는
ANTHROPIC_API_KEY=your_key
# 또는
UPSTAGE_API_KEY=your_key
```

### 4. 앱 실행
```bash
streamlit run simulation_app.py
```

## 사용 방법

### 1단계: 여행 계획 생성
1. 상단 "여행 계획 생성" 확장 메뉴 클릭
2. 계획 입력 (예: "내일 서울 여행. 경복궁 → 명동 → 남산타워")
3. "계획 생성" 버튼 클릭

### 2단계: 자동 진행으로 시뮬레이션
1. "자동 진행 시작" 버튼 클릭
2. 지도에서 빨간 선이 그려지며 경로 표시
3. 각 지점 도착 시 자동으로 알림 생성
4. 오른쪽 핸드폰 화면에서 알림 실시간 확인

### 3단계: 알림 확인 및 챗봇 이용
1. 핸드폰 화면에서 새 알림 확인
2. "챗봇" 버튼으로 AI 도우미와 대화
3. 현재 상황 기반 조언 받기

## 기술 스택

- **Frontend**: Streamlit
- **지도 시각화**: Plotly (3D Scattermapbox)
- **LLM**: OpenAI / Anthropic / Upstage
- **Data Storage**: JSON (RAG 시스템)
- **Geospatial**: Haversine distance
- **Python**: 3.8+

## 주요 컴포넌트

### simulation_app.py
- 3D 지도 생성 (`create_map`)
- 자동 진행 로직 (`auto_move_to_next_activity`)
- 분할 화면 레이아웃
- 실시간 알림 표시

### agent/plan_generator.py
- LLM 기반 계획 생성
- 자연어 → JSON 변환

### agent/plan_rag.py
- 계획 저장/검색
- 트리거 조건 확인
- Haversine 거리 계산

### agent/simulator.py
- 위치/시간/날씨 시뮬레이션
- 이동 경로 생성 (10단계)
- 알림 관리

## 자동 진행 흐름

```
[자동 진행 시작]
    ↓
[계획의 첫 활동 선택]
    ↓
[현재 위치 → 목표 위치 경로 생성 (10단계)]
    ↓
[각 단계마다]
    ├─ 위치 업데이트
    ├─ 지도에 경로 추가 (빨간 선)
    ├─ 0.3초 대기
    └─ 다음 단계
    ↓
[목적지 도착]
    ├─ 시간 업데이트
    ├─ 트리거 확인
    └─ 알림 생성
    ↓
[다음 활동으로 이동]
    ↓
[모든 활동 완료 시 종료]
```

## 화면 구성

### 왼쪽 (지도 + 컨트롤)
- **3D 지도**
  - 파란 마커: 계획된 활동 지점
  - 빨간 마커: 현재 위치
  - 빨간 선: 이동 경로
  
- **제어 패널**
  - 자동 진행 시작/다음/초기화
  - 빠른 이동 버튼 (활동별)
  - 수동 제어 (시간/위치/날씨)
  - 트리거 확인

### 오른쪽 (핸드폰)
- **상태바**: 시간 | 위치 | 날씨
- **알림 목록**: 읽음/새 알림 구분
- **챗봇**: 간단한 대화 (최근 3개 표시)

## MVP 특징

- **실제 경로 시각화**: 지도에서 이동 경로를 눈으로 확인
- **자동 애니메이션**: 버튼 하나로 전체 여행 시뮬레이션
- **동시 화면 표시**: 지도와 핸드폰을 동시에 볼 수 있음
- **완전한 에이전트**: RAG, 트리거, 알림 모두 실제 구현

## 향후 개선 사항

1. **실제 API 통합**
   - Google Maps API (실제 경로)
   - OpenWeatherMap API (실제 날씨)

2. **모바일 앱 개발**
   - 실제 GPS 연동
   - 푸시 알림

3. **고급 시각화**
   - 3D 건물 표시
   - 더 부드러운 애니메이션
   - 교통 정보 표시

## 라이센스

MIT License
