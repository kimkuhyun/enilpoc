# AI 여행 시뮬레이터 - 실시간 2D 지도 + 안드로이드 UI

pydeck 2D 지도에서 실시간으로 이동하며 안드로이드 핸드폰 화면에서 알림을 받는 여행 시뮬레이터입니다.

## 주요 기능

### 1. pydeck 2D 지도 시각화
- **ScatterplotLayer**: 활동 지점 (파란 원)
- **LineLayer**: 이동 경로 (빨간 선)
- **현재 위치**: 빨간 큰 원으로 표시
- **실시간 업데이트**: 이동 시 지도가 자동으로 업데이트

### 2. 안드로이드 핸드폰 화면
```
┌──────────────────┐
│ [상태바]         │
│ 14:30 | 남산타워  │
├──────────────────┤
│                  │
│ 알림 (2 / 5)    │
│                  │
│ [NEW] 경복궁 관광│
│ 경복궁에 도착   │
│ 14:30           │
│                  │
│ [읽음] 점심식사  │
│ 북촌 한식당     │
│ 12:00           │
│                  │
└──────────────────┘
```

### 3. 자동 진행 + 알림 확인 로직
**자동 진행 버튼 클릭 시:**
1. 계획의 첫 활동 지점으로 이동 (10단계, 0.2초 간격)
2. 도착 시 자동으로 트리거 확인
3. **알림이 생성되면 자동 진행 일시 중지**
4. 사용자가 핸드폰에서 "확인" 버튼 클릭
5. 알림 확인 후 자동으로 다음 활동으로 진행

**말풍선으로 캐릭터 상태 표시:**
- "경복궁으로 가는 중..."
- "알림이 왔다!"
- "알림이 왔는데... 확인해볼까?"

### 4. 완전한 여행 계획
**계획에 포함되는 내용:**
- 관광명소 (궁궐, 타워, 박물관, 공원)
- 음식점 (레스토랑, 카페, 맛집) - 식사 시간에 배치
- 쇼핑/체험 (쇼핑센터, 시장, 체험 공간)

**예시 계획:**
```
09:00 경복궁 관람 (관광명소)
12:00 북촌 한식당 점심 (음식점)
14:00 인사동 쇼핑 (쇼핑)
17:00 남산타워 전망대 (관광명소)
19:00 명동 맛집 저녁 (음식점)
```

### 5. 분할 화면 레이아웃
```
┌─────────────────────┬──────────────┐
│  왼쪽 (2/3)         │  오른쪽 (1/3) │
│                     │               │
│  [말풍선]           │  안드로이드   │
│  "경복궁으로..."    │  핸드폰 화면  │
│                     │               │
│  pydeck 2D 지도     │  [상태바]    │
│  ├─ 활동 지점      │  시간 | 위치  │
│  ├─ 이동 경로      │               │
│  └─ 현재 위치      │  [알림 목록]  │
│                     │  - NEW       │
│  [제어 패널]       │  - 읽음      │
│  [자동][다음][초기] │               │
└─────────────────────┴──────────────┘
```

## 설치 및 실행

### 1. 패키지 설치
```bash
cd enilpoc
pip install -r requirements.txt
```

### 2. API 키 설정
`.env` 파일:
```env
OPENAI_API_KEY=your_key
```

### 3. 실행
```bash
streamlit run simulation_app.py
```

## 사용 방법

### 1단계: 계획 생성
```
입력 예시:
"서울 하루 여행. 오전 경복궁 관람, 점심 북촌 한식당,
오후 인사동 쇼핑, 저녁 명동 맛집"

AI가 자동으로:
- 각 장소의 위도/경도 추출
- 시간 배정 (09:00, 12:00, 14:00, 19:00)
- 트리거 조건 생성
- 음식점과 관광명소를 구분하여 배치
```

### 2단계: 자동 진행
1. "자동 진행" 버튼 클릭
2. 지도에서 이동 경로 확인 (빨간 선)
3. 말풍선으로 캐릭터 상태 확인
4. **알림이 오면 핸드폰 화면에서 "확인" 버튼 클릭**
5. 다음 활동으로 자동 진행

### 3단계: 알림 확인
- 핸드폰 화면의 알림 목록에서 확인
- [NEW] 표시된 알림은 미확인
- "확인" 버튼 클릭 시 읽음 처리
- 자동 진행 재개

## 자동 진행 플로우

```
[자동 진행 시작]
    ↓
[1번 활동 지점으로 이동]
    ├─ 10단계 이동 (0.2초 간격)
    ├─ 지도에 빨간 선 그리기
    └─ 말풍선: "경복궁으로 가는 중..."
    ↓
[도착]
    ├─ 시간 업데이트
    ├─ 트리거 확인
    └─ 알림 생성
    ↓
[알림 확인 대기] ⏸
    ├─ 자동 진행 일시 중지
    ├─ 말풍선: "알림이 왔다!"
    └─ 핸드폰 화면에 [NEW] 알림 표시
    ↓
[사용자가 "확인" 클릭] ▶
    ├─ 알림 읽음 처리
    └─ 자동 진행 재개
    ↓
[2번 활동 지점으로 이동]
    ↓
[반복...]
    ↓
[모든 활동 완료]
```

## 기술 스택

- **지도**: pydeck (ScatterplotLayer, LineLayer)
- **UI**: Streamlit + Custom CSS
- **LLM**: OpenAI / Anthropic / Upstage
- **상태 관리**: Streamlit Session State
- **Geospatial**: Haversine distance

## 주요 컴포넌트

### simulation_app.py
- `create_pydeck_map()`: 2D 지도 생성
- `get_character_thought()`: 캐릭터 생각 생성
- `auto_move_to_next_activity()`: 자동 진행 + 알림 대기
- 안드로이드 UI 렌더링

### agent/plan_generator.py
- 음식점, 관광명소 포함 계획 생성
- 시스템 프롬프트 개선

### agent/simulator.py
- `simulate_movement()`: 10단계 이동 경로
- 알림 관리

## 특징

### 실시간 동기화
- 지도와 핸드폰 화면이 동시에 업데이트
- 이동 경로가 실시간으로 그려짐
- 말풍선으로 캐릭터 상태 표시

### 알림 확인 로직
- 자동 진행 중 알림 발생 시 일시 중지
- 사용자가 확인해야 다음 단계로 진행
- 핸드폰 화면에만 알림 표시 (하단 제거)

### 완전한 계획
- 관광명소, 음식점, 쇼핑 포함
- 시간대별로 적절히 배치
- 식사 시간에 맞춰 음식점 추가

## 향후 개선

1. **캐릭터 애니메이션**
   - SVG로 걷는 애니메이션
   - 방향에 따라 캐릭터 회전

2. **더 리얼한 UI**
   - 안드로이드 알림 사운드
   - 진동 효과 시뮬레이션

3. **고급 지도 기능**
   - 실제 도로 경로
   - POI 표시
   - 거리/시간 계산

## 라이센스

MIT License
